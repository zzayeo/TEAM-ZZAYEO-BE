# Team-zzayeo-BE

# âœˆï¸'ì§œì—¬' ì„œë¹„ìŠ¤ ì„¤ëª… ë³´ëŸ¬ê°€ê¸°

> [ë©”ì¸ ReadMe.md](https://github.com/zzayeo)ë¥¼ ì°¸ê³  í•´ì£¼ì„¸ìš”!

> 'ì§œì—¬' ì‚¬ì´íŠ¸ê°€ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´ ì•„ë˜ ë°”ë¡œê°€ê¸°ë¥¼ ì°¸ê³  í•´ì£¼ì„¸ìš”!
> 
<center>

[![ë°”ë¡œê°€ê¸° ë²„íŠ¼](https://firebasestorage.googleapis.com/v0/b/megazine-11a01.appspot.com/o/images%2Fimg-bg%20(5).png?alt=media&token=647fca42-c2b2-479b-afe5-7b2af5ea32f7)](https://zzayeo.com/)

</center>

<br/>

![image](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ae7c4c3e-cd78-44f9-bab6-20cdf8d69cc7/Group_366.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220409%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220409T052741Z&X-Amz-Expires=86400&X-Amz-Signature=414b544a35d678e723b9ed707240b0c41f92a7bf3205782387273c4ce9365a2a&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Group%2520366.png%22&x-id=GetObject)

---

# ğŸ™‹ íŒ€ì› ì†Œê°œ

|   ì´ë¦„   |                        ê¹ƒí—ˆë¸Œ ì£¼ì†Œ                         | í¬ì§€ì…˜ |
| :------: | :--------------------------------------------------------: | :----: |
|  ì´ê¸°ê³¤  |   [https://github.com/LeeKiGont](https://github.com/LeeKiGon)   | ë°±ì—”ë“œ |
|  ì„œë™í˜„  |     [https://github.com/donghyeon23](https://github.com/donghyeon23)     | ë°±ì—”ë“œ |
|  ì´ì¬ì •  | [https://github.com/jaejeonglee](https://github.com/jaejeonglee) | ë°±ì—”ë“œ |

<br>

---

# :hammer: ê¸°ìˆ  ìŠ¤íƒ

|  ì´ë¦„   |       ì„¤ëª…       |
| :-----: | :--------------: |
| AWS EC2 |   ì„œë²„ ì¸ìŠ¤í„´ìŠ¤   |
| Node.js |   JS ì‹¤í–‰ í™˜ê²½    |
| Express | nodeJS Framework |
| mongoDB |   ë°ì´í„° ë² ì´ìŠ¤   |
|   git   |    ë²„ì „ ê´€ë¦¬      |
|  nginx  |  Reverse Proxy   |
<br>

---

# :book: ë¼ì´ë¸ŒëŸ¬ë¦¬

|       name        |            Appliance             | version  |
| :---------------: | :------------------------------: | :------: |
|     mongoose      |         ë°ì´í„°ë² ì´ìŠ¤ ORM         |  6.2.4  |
|       cors        |          cors ì •ì±… ì„¤ì •          |  2.8.5   |
|      dotenv       |          í™˜ê²½ë³€ìˆ˜ ì„¤ì •           |  16.0.0  |
|      multer       |        ì´ë¯¸ì§€ ë°ì´í„° ì²˜ë¦¬        |  1.4.4   |
|     multer-S3     |         ì‚¬ì§„ íŒŒì¼ ì—…ë¡œë“œ         |  2.10.0  |
|      aws-sdk      |             S3 ì ‘ê·¼              | 2.1085.0 |
|     socket.io     |        ì›¹ì†Œì¼“ ë¼ì´ë¸ŒëŸ¬ë¦¬         |  4.4.1   |
|   jsonwebtoken    | Json í¬ë§·ìœ¼ë¡œ ì‚¬ìš©ì ì†ì„±ì„ ì €ì¥ |  8.5.1   |
|      bcrypt       |         ë¹„ë°€ë²ˆí˜¸ í•´ì‰¬í™”          |  5.0.1   |
|     passport      |         ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„         |  0.5.2   |
|      helmet       |         ì„œë²„ ë³´ì•ˆì„± í–¥ìƒ         |  5.0.2   |
|      uniqid       |         ê³ ìœ ê°’ ìƒì„±            |  5.4.0   |
|     prettier      |         ì½”ë“œ ìŠ¤íƒ€ì¼ í†µì¼         |  2.5.1   |

---

 # ğŸ“‘ ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜
 
![ì§œì—¬ì•„í‚¤í…ì²˜](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/80585eb7-6129-426d-b207-282ee99fed53/Frame_2.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220409%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220409T050829Z&X-Amz-Expires=86400&X-Amz-Signature=10e476b6910703221bf34fa1d6c7cf6320a12e7eeb358cf190754fe2d42fbda7&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Frame%25202.png%22&x-id=GetObject)
 
 ---
 
# ğŸ”¥ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
<details>
  <summary> <h3>ì›¹ ì†Œì¼“,ì±„íŒ…</h3></summary>
<div markdown="1">
  
  ### ìš”êµ¬ ì‚¬í•­
  
  ì±„íŒ…ê¸°ëŠ¥ì´ êµ¬í˜„ëœ ìƒíƒœì—ì„œ ìœ ì €ê°€ ì›¹ì— ë“¤ì–´ì™€ ìˆì„ ë•Œ ì±„íŒ…ë°©ì— ì ‘ì†í•´ìˆì§€ ì•Šì•„ë„ ì±„íŒ…ì´ ì™”ëŠ”ì§€ ì•Œ ìˆ˜ ìˆì–´ì•¼ í•˜ê³ , í•´ë‹¹ ìœ ì €ì˜ ê²Œì‹œê¸€ì— ëŒ€í•œ íƒ€ìœ ì €ì˜ ë°˜ì‘ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì•Œë ¤ì¤„ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ê³  ìƒê°.
![image](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/5a837a8b-79de-483c-b832-d1d6c982269e/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-02_03.21.32.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220409%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220409T051231Z&X-Amz-Expires=86400&X-Amz-Signature=3cd33a5931299866e4f3d96d226e1b0bf49ffded3a1fd7ecf48c9cee8ccf3b49&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%25202022-04-02%252003.21.32.png%22&x-id=GetObject)
  
  ### ì„ íƒì§€
  
  1. ìƒˆë¡œìš´ ì•Œë¦¼ ë° ë©”ì„¸ì§€ë¥¼ í™•ì¸ í• ìˆ˜ ìˆëŠ” APIë¥¼ ë§Œë“¤ì–´ ì£¼ê¸°ì ìœ¼ë¡œ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë³´ë‚´ì¤€ë‹¤.
  
  2. socket ì´ë²¤íŠ¸ê°€ ë°œìƒí• ë•Œë§ˆë‹¤ ê°œë³„ ìœ ì €ì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ì¤€ë‹¤.
  
  ### ì˜ì‚¬ê²°ì • ë° ê·¼ê±°
  
  - socketìœ¼ë¡œ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì•Œë ¤ì¤€ë‹¤.

    ìƒˆë¡œìš´ ì•Œë¦¼ ë° ë©”ì„¸ì§€ë¥¼ í™•ì¸ í• ìˆ˜ ìˆëŠ” APIë¥¼ ë§Œë“¤ì–´ ì£¼ê¸°ì ìœ¼ë¡œ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë³´ë‚´ì¤€ë‹¤ë©´ ì‹¤ì‹œê°„ ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ëŠ” ìˆê² ì§€ë§Œ, ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•Šì€ ìƒí™©ì—ì„œ ìš”ì²­ì„ í•˜ê²Œëœë‹¤ë©´ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì—ì„œëŠ” ë¶ˆí•„ìš”í•œ ë¹„ìš©ì„ ì‚¬ìš©í•˜ê²Œ ë  ê²ƒì´ë‹¤. ê·¸ë˜ì„œ socketì„ ì´ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ì•Œë¦¼ì„ ì„ íƒí•˜ê²Œ ë˜ì—ˆë‹¤.
  ```javaScript
  // user A ì™€ Bì˜ snsId ë¥¼ ë°›ì•„ ê³ ìœ  RoomName ìƒì„±ì‹œì¼œì¤Œ
const roomNameCreator = (snsIdA, snsIdB) => {
        const roomName = [snsIdA, snsId];
        arr.sort((a, b) => a - b);
        let createdRoomName= roomName[0] + roomName[1];
        return createdRoomName;
    };


// user ê°€ ì±„íŒ…ì„ ë³´ëƒˆì„ë•Œ DBì— ì €ì¥í›„ í•´ë‹¹ Roomì— ë‹¤ì‹œ ë¿Œë ¤ì¤€ë‹¤.
socket.on('room', async ({ fromSnsId, toSnsId, chatText, createdAt }) => {
        ...
				const roomName = await roomNameCreator(fromSnsId, toSnsId)
        io.to(roomName).emit('chat', chatMessage);
				...
  ```
  ![image](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/fc87e835-4fd1-4411-a0ff-e73c2ec77738/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-02_03.21.39.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220409%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220409T051727Z&X-Amz-Expires=86400&X-Amz-Signature=d5d0c7a7c81a52d6f9961e6cb40adc55e5102ff96f51b5304bf4a39f7772e13c&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%25202022-04-02%252003.21.39.png%22&x-id=GetObject)
  
ì¶”ê°€ì ìœ¼ë¡œ, ì±„íŒ…ë°© ì ‘ì† ì‹œ RoomName ì„ ìƒì„±í•´ì„œ ì ‘ì†í•˜ëŠ”ë°, ìœ ì €ê°€ í•´ë‹¹ Roomì— ì ‘ì†í•´ìˆì§€ ì•Šì€ ê²½ìš° ë©”ì„¸ì§€ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ì„ìˆ˜ ì—†ì—ˆë‹¤.
  
  ```javascript
  // ë¡œê·¸ì¸ ì‹œ í•´ë‹¹ ìœ ì € snsId ë¡œ ëœ Roomìœ¼ë¡œ ë³´ë‚´ì¤Œ
socket.on('login', async ({ fromSnsId }) => {
        socket.join(fromSnsId);
        const checkNew = await NoticeService.checkNewNotice({ snsId: fromSnsId})
        io.to(fromSnsId).emit('checkNewNotice', checkNew)
    });

// user ê°€ ì±„íŒ…ì„ ë³´ëƒˆì„ë•Œ DBì— ì €ì¥í›„ í•´ë‹¹ Roomê³¼ ë‹¤ë¥¸ User Room ì—ë„ ë¿Œë ¤ì¤€ë‹¤.
socket.on('room', async ({ fromSnsId, toSnsId, chatText, createdAt }) => {
        ...
				const roomName = await roomNameCreator(fromSnsId, toSnsId)
        io.to(roomName).emit('chat', chatMessage);
				io.to(toSnsId).emit('chat', chatMessage);
				...
  ```
  ![image](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/eeaad0e1-9055-40cd-933d-6bd0168f74e5/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-04-02_03.21.49.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220409%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220409T051849Z&X-Amz-Expires=86400&X-Amz-Signature=9e28535f78736bb163a70cf86bf4cf64f003c163b3a260fd52c092157d397582&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%25202022-04-02%252003.21.49.png%22&x-id=GetObject)
  
  ìœ ì €ê°€ ë¡œê·¸ì¸ ì‹œ ë³¸ì¸ì˜ IDë¡œ ëœ Room ì— ì ‘ì†í•˜ê²Œ í•˜ê²Œ í•œ í›„ ì±„íŒ… ì‹œ Roomê³¼ í•´ë‹¹ ìœ ì € Room ì— ë™ì‹œì— ì´ë²¤íŠ¸ë¥¼ ì†¡ì‹ í•˜ì—¬ ì±„íŒ…ë°© ì ‘ì† ì—¬ë¶€ì— ìƒê´€ì—†ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°›ì„ìˆ˜ ìˆë„ë¡ í–ˆë‹¤.

ì±„íŒ…ë°©ì— ì…ì¥í•  ë• ê¸°ì¡´ì˜ Room ì—°ê²°ì„ ëŠê³ , ê³ ìœ  roomNameë¡œ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ì—°ê²°ì„ í•´ì£¼ê³  ì±„íŒ…ë°©ì—ì„œ ë‚˜ì˜¬ ë•ŒëŠ” ì´ ê³¼ì •ì„ ë°˜ëŒ€ë¡œ í•´ì¤Œ. ì´ë ‡ê²Œ í•´ì„œ ìœ ì €ëŠ” ì±„íŒ…ë°© ì…ì¥ ì‹œ ê°™ì€ roomNameë¥¼ í†µí•´ ì±„íŒ…ì´ ê°€ëŠ¥í•˜ê³  ì±„íŒ…ë°©ì„ ë¹ ì ¸ë‚˜ì™€ì„œë„ ê°ìì˜ ì†Œì¼“ì£¼ì†Œë¥¼ í†µí•´ ì‹¤ì‹œê°„ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ì¡°ê±´ì´ ë§ˆë ¨ë¨.

ìœ„ì—ì„œ ë§ˆë ¨ëœ ì¡°ê±´ì„ í†µí•´ ì±„íŒ…ë©”ì„¸ì§€ë¿ë§Œ ì•„ë‹ˆë¼í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒˆë¡œìš´ ì´ë²¤íŠ¸ê°€ ë°œìƒ ì‹œ í•´ë‹¹ ìœ ì €ì˜ ì†Œì¼“ìœ¼ë¡œ emitì„ í•˜ë„ë¡ í•˜ê³ , ì„œë²„ì—ì„  onìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ í•´ë‹¹ ìœ ì €ì˜ ì•Œë¦¼ì°½ìœ¼ë¡œ ì´ë²¤íŠ¸ì˜ ë°œìƒì„ ì•Œë ¤ì¤„ ìˆ˜ ìˆê²Œë¨.
  
  ![image](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/eda2df5d-7451-4b4a-ab08-8b3d03ac1b8f/%ED%99%94%EB%A9%B4_%EC%BA%A1%EC%B2%98_2022-04-01_013827.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220409%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220409T051936Z&X-Amz-Expires=86400&X-Amz-Signature=cb484e374304f57c7f1ebdf4c73466e9ac40657d0a6e991ba5bcabf0d5a1ea7f&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22%25ED%2599%2594%25EB%25A9%25B4%2520%25EC%25BA%25A1%25EC%25B2%2598%25202022-04-01%2520013827.jpg%22&x-id=GetObject)
  
</div>
</details>
  
<details>
  <summary> <h3>ì¸ê¸°ìˆœìœ¼ë¡œ ì •ë ¬í•˜ê¸°</h3></summary>
<div markdown="1">
  
  ### ìš”êµ¬ì‚¬í•­
  
  ë©”ì¸í˜ì´ì§€ì—ì„œ DBì— ìˆëŠ” â€œì¢‹ì•„ìš”â€, â€œë¶ë§ˆí¬â€ ì²˜ëŸ¼ ë¶„ì•¼ë³„ë¡œ í‘œí˜„í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ê°€ì¥ ì¸ê¸°ê°€ ë§ì€ ê²Œì‹œë¬¼ì„ ë…¸ì¶œì‹œí‚¤ê¸° ìœ„í•´  ëª¨ë“  ë¶„ì•¼ì˜ ê°œìˆ˜ë¥¼ ë‹¤ ë”í•´ì¤€ ìƒˆë¡œìš´ ê°’(totalcount)ì´ í•„ìš”í–ˆë‹¤.

ê¸°ì¡´ì— ì¢‹ì•„ìš” ê°œìˆ˜, ë¶ë§ˆí¬ ê°œìˆ˜ë¥¼ í‘œí˜„í•  ë•ŒëŠ” í•´ë‹¹ ê²Œì‹œê¸€ì´ë‚˜ ëŒ“ê¸€ì˜ _idê°€ í¬í•¨ëœ ë„íë¨¼íŠ¸ë¥¼ ì „ë¶€ countí•´ì„œ mongooseê¸°ëŠ¥ì¸ VirtualFieldë¥¼ ìƒì„± í›„ populateë¡œ í•´ë‹¹ VirtualFieldë¥¼ response í–ˆìœ¼ë¯€ë¡œ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ totalcountë¥¼ ì •ë ¬í•˜ë ¤ í–ˆëŠ”ë° sortëŠ” DBì— ìˆëŠ” field ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ì€ ê°€ëŠ¥í•˜ì§€ë§Œ  virtualë¡œ ì •ì˜ëœ ìŠ¤í‚¤ë§ˆëŠ” mongoDBì—ì„œ ì œê³µí•˜ëŠ” queryë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í–ˆë‹¤.
  
  ### ì„ íƒì§€
  
  1. ê°ê°ì˜ ì»¬ë ‰ì…˜ì— ìƒˆë¡œìš´ í•„ë“œë¥¼ ë§Œë“¤ì–´ì£¼ì–´ ê·¸ í•„ë“œì— countëœ ê°’ì„ ë„£ì–´ì¤„ ìƒê°ì„ í–ˆë‹¤.
  
  2. mongoDBì—ì„œ ì œê³µí•˜ëŠ” aggregateë¼ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸°.
  
  ### ì˜ì‚¬ê²°ì • ë° ê·¼ê±°
  
  - aggregate ì‚¬ìš©í•˜ê¸°.
    
    lookupìœ¼ë¡œ DBì— ìˆëŠ” ê°’ì„ ê°€ì ¸ì™€ì„œ addFields(mongoDB 4.2ë²„ì „ë¶€í„° ì¶”ê°€)ë¥¼ í†µí•´ totalcountë¥¼ ìƒì„±í•˜ê³  sortí•´ì£¼ì—ˆë‹¤. aggregateëŠ” virtualì²˜ëŸ¼ mongooseì—ì„œ ì²˜ë¦¬í•´ì£¼ëŠ” ê²ƒì´ ì•„ë‹ˆê³  mongoDBì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ sortê°€ ê°€ëŠ¥í–ˆë‹¤.
    
    totalcountëŠ” í•´ë‹¹ ë¡œì§ ë‚´ì—ì„œë§Œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— DBì— insert,updateí•˜ëŠ” í–‰ìœ„ë¥¼ ì¤„ì¸ë‹¤ëŠ” ì¥ì ê³¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•„ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ë©´ì„œ ë°œìƒí•˜ëŠ” ë¹„ìš©ì„ ì—†ì•¨ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì„ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.
  
</div>
</details>
